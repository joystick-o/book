# 2장 테스트

테스트란 내가 예상하고 의도했던 대로 코드가 정확히 동작하는지를 확인해서 만든 코드를 확신할 수 있게 해주는 작업.

```java
public class UserDaoTest (
	public static void main(String[] args) throws SQLException (
		ApplicationContext context = new GenericXmlApplicationContext(
			"applicationContext.xml");
		
		UserDao dao = context.getBean("userDao", UserDao.class);
		User user = new User(); 
		user.setld("user"); 
		user.setName("백기선"); 
		user.setPassword("married");
		
		dao.add(user);
		
		System.out.println(user.getId() + " 등록 성공“);
		
		User user2 = dao.get(user.getld()); 
		System.out.println(user2.getName()); 
		System.out.println(user2.getPassword());
		
		System.out.println(user2.getld() + " 조회 성공");
	}
}
```

* 자바에서 가장 손쉽게 실행 가능한 main\(\) 메소드를 이용한다.
* 테스트 할 대상인 UserDao의 오브젝트를 가져와 메소드를 호출한다.
* 테스트에 사용할 입력 값\(User 오브젝트\)을 직접 코드에서 만들어 넣어준다.
* 테스트의 결과를 콘솔에 출력해준다.
* 각 단계의 작업이 에러 없이 끝나면 콘솔에 성공 메시지로 출력해준다.

### 웹을 통한 DAO 테스트 방법의 문제점

보통 웹 프로그램에서 사용하는 DAO를 테스트하는 방법은 테스트용 웹 애플리케이션은 서버에 배치한 뒤, 웹 화면을 띄워 폼을 열고, 값을 입력한 뒤 버튼을 눌러 등록 해본다. 이 방법은 단점이 너무 많다.  
DAO를 테스트하려고 만든 다른 코드 때문에 에러가 나거나 테스트가 실패할 수도 있다.

### 작은 단위의 테스트

테스트하고자 하는 대상이 명확하다면 그 대상에만 집중해서 테스트하는 것이 바람직하다.  
작은 단위의 코드에 대해 테스트를 수행하는 것은 단위 테스트\(unit test\)하고 한다.

일반적으로 단위는 작을수록 좋은데 그런 의미에서 UserDaoTest는 단위 테스트하고 부를 수 있다.  
다만, 테스트가 DB의 상태를 관장하고 있어야 한다.  
테스트마다 DB의 상태가 달라지고, 테스트를 위해 DB를 특정 상태로 만들어줄 수 없다면 단위 테스트로서 가치가 없어진다.

테스트의 단위가 작을수록 오류가 발생했을때 쉽게 문제의 원인을 찾고 수정할 수 있다.

### 자동수행 테스트 코드

UserDaoTest 의 한 가지 특징은 테스트할 데이터가 코드를 통해 제공되고 테스트 작업 역시 자동으로 실행된다는 점이다.  
메소드 실행만으로 add\(\) 메소드를 호출하고, 그 티 값으로 get\(\) 메소드를 호출하는 것까지 자동으로 진행된다.

웹 화면에 폼을 띄우고 값을 입력하고 버튼을 클릭하는 번거로움이 없기 때문에  
자주 반복할 수 있고 빠르게 실행할 수 있다.

### 지속적인 개선과 점진적인 개발을 위한 테스트

처음 만든 초난감 DAO 코드를, 스프링을 이용한 깔끔하고 완성도 높은 객체지향적 코드로 발전시키는 과정의 일등 공신이 바로 테스트였다.

DAO 코드를 만들자마자 테스트 코드를 만들어뒀기 때문에, 자신을 가지고 조금씩 코드를 개선해나가는 작업을 진행할 수 있었다.  
코드를 다 만들고 난 뒤에 검증을 하려고 한다면, 어디서부터 잘못 만든건지 찾는 시간을 보내야 했을 것이다.  
작은 단계를 거치는 동안 테스트를 수행해서 확신을 가지고 코드를 변경해갔기 때문에 코드를 개선하는 작업에 속도가 붙고 더 쉬워졌을 수도 있다.

### UserDaoTest의 문제점

#### 수동 확인 작업의 번거로움

add\(\) 에서 User 정보를 DB에 등록하고, 이를 다시 get\(\)을 이용해 가져왔을때 입력한 값과 가져온 값이 일치하는지를 눈으로 확인해야 한다.

#### 실행 작업의 번거로움

간단히 실행 가능한 main\(\) 메소드라고 하더라도 매번 그것을 실행하는 것은 번거롭다.

## UserDaoTest 개선

### 테스트 검증의 자동화

```java
System.out.println(user2.getName()); 
System.out.println(user2.getPassword());
System.out.println(user2.getld() + " 조회 성공");
```

```java
if (!user.getName().equals(user2.getName())) {
    System.out.println("테스트 실패 (name)");
}
else if (!user.getPassword().equals(user2.getPassword())) {
    System.out.println("테스트 실패 (password)");
}
else {
    System.out.println(user.getId() + "조회 성공");
}
```

### 테스트의 효율적인 수행과 결과 관리

자바에는 단순하면서도 실용적인 테스트를 위한 도구가 여러 가지 존재한다.  
그중에서도 자바 테스팅 프레임워크라고 불리는 JUnit은 자바로 단위 테스르응 만들 때 유용하게 쓸 수 있다.

### JUnit 테스트로 전환

JUnit은 프레임워크다. 프레임워크에서 동작하는 코드는 main\(\) 메소드도 필요 없고 오브젝트를 만들어서 실행시키는 코드를 만들 필요도 없다.

### 테스트 메소드 전환

JUnit 프레임워크가 요구하는 조건 두가지를 따라야 한다.

* public으로 선언돼야 한다.
* 메소드에 @Test 애노테이션을 붙여준다.

```java
public class UserDaoTest {
    // JUnit에게 테스트 메소드임을 알려줌
    @Test
    // JUnit 테스트 메소드는 반드시 public으로 선언되어야 함
    public void addAndGet() throws SQLException {
        ApplicationContext context = new
            ClassPathXmlApplicationContext("applicationContext.xml");
            
        UserDao dao = context.getBean("userDao", UserDao.class);
        ...
    }
}
```

### 검증 코드 전환

```java
public class UserDaoTest {
    @Test
    public void addAndGet() throws SQLException {
        ApplicationContext context = new ClassPathXmlApplicationContext(
            "applicationContext.xml");
            
        UserDao dao = context.getBean("userDao", UserDao.class);
        User user = new User();
        user.setId("gyumee");
        user.setName("박성철");
        user.setPassword("springno1");

        dao.add(user);

        User user2 = dao.get(user.getId());

        assertThat(user2.getName(), is(user.getName()));
        assertThat(user2.getPassword(), is(user.getPassword()));
    }
}
```

### JUnit 테스트 실행

JUnit 테스트를 실행할 main\(\) 메소드

```java
public static void main(String[] args) {
    JUnitCore.main("springbook.user.dao.UserDaoTest");
}
```

### 테스트 결과의 일관성

UserDaoTest의 문제는 이전 테스트 때문에 DB에 등록된 중복 데이터가 있을 수 있다는 점이다.

